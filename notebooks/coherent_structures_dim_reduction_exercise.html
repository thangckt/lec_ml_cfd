
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Analyzing coherent structures in flows displaying transonic buffets &#8212; Machine learning in computational fluid dynamics</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="https://github.com/thangckt/note/blob/main/docs/1images/one-note-128-y.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reduced-order modeling of the flow past a cylinder in flowTorch" href="cylinder_rom_exercise.html" />
    <link rel="prev" title="Approximating the flow past a cylinder with limited data" href="cylinder_pinn_exercise.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Machine learning in computational fluid dynamics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    Machine learning in computational fluid dynamics
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Lectures
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="ml_cfd_intro.html">
   Course overview and motivation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cfd_intro.html">
   Finite-volume-based CFD in a nutshell
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ml_intro.html">
   Introduction to machine learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bubble_path_classification.html">
   Predicting the stability regime of rising bubbles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mass_transfer_regression.html">
   Computing highly accurate mass transfer at rising bubbles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cylinder_pinn.html">
   Approximating the flow past a cylinder with limited data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coherent_structures_dim_reduction.html">
   Analyzing coherent structures in flows displaying transonic buffets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cylinder_rom.html">
   Reduced-order modeling of the flow past a cylinder
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cylinder_bayesian_opt.html">
   Optimizing parameters for open-loop flow control
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cylinder_drl.html">
   Controlling the flow past a cylinder
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Exercises
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="python_intro.html">
   A brief introduction to Python programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="system_setup.html">
   Setting up your system
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cfd_intro_exercise.html">
   End-to-end simulations in OpenFOAM and Basilisk
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ml_intro_exercise.html">
   End-to-end ML project with OpenFOAM and PyTorch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bubble_path_classification_exercise.html">
   Predicting the stability regime of rising bubbles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mass_transfer_regression_exercise.html">
   Computing highly accurate mass transfer at rising bubbles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cylinder_pinn_exercise.html">
   Approximating the flow past a cylinder with limited data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Analyzing coherent structures in flows displaying transonic buffets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cylinder_rom_exercise.html">
   Reduced-order modeling of the flow past a cylinder in flowTorch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cylinder_bayesian_opt_exercise.html">
   Open-loop control of the flow past a cylinder
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cylinder_drl_exercise.html">
   Controlling the flow past a cylinder with OpenFOAM and PyTorch
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/notebooks/coherent_structures_dim_reduction_exercise.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#principal-component-analysis">
   Principal component analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-and-masking-the-dataset">
     Loading and masking the dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-the-singular-value-decomposition">
     Computing the singular value decomposition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-modes-and-mode-coefficients">
     Visualizing modes and mode coefficients
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dynamic-mode-decomposition">
   Dynamic mode decomposition
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dmd-implementation">
     DMD implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-the-spectrum">
     Plotting the spectrum
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Analyzing coherent structures in flows displaying transonic buffets</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#principal-component-analysis">
   Principal component analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#loading-and-masking-the-dataset">
     Loading and masking the dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computing-the-singular-value-decomposition">
     Computing the singular value decomposition
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-modes-and-mode-coefficients">
     Visualizing modes and mode coefficients
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dynamic-mode-decomposition">
   Dynamic mode decomposition
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dmd-implementation">
     DMD implementation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plotting-the-spectrum">
     Plotting the spectrum
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p><img alt="CC" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></p>
<p>This work is licensed under a <a class="reference external" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
<section class="tex2jax_ignore mathjax_ignore" id="analyzing-coherent-structures-in-flows-displaying-transonic-buffets">
<h1>Analyzing coherent structures in flows displaying transonic buffets<a class="headerlink" href="#analyzing-coherent-structures-in-flows-displaying-transonic-buffets" title="Permalink to this headline">#</a></h1>
<p><strong>Note: this exercise still needs to be updated for the winter term 2022/2023.</strong></p>
<p>This exercise consists of two parts, which are meant to be solved in two individual exercise sessions. In the first part, we analyze coherent structures in the surface pressure coefficient of a NACA0012 airfoil in transonic flow conditions by means of a principal component analysis (PCA). In the second part, we analyze the same data using dynamic mode decomposition (DMD). The specific flow conditions in terms of Reynolds number, Mach number, and angle of attack are <span class="math notranslate nohighlight">\(Re=10^7\)</span>, <span class="math notranslate nohighlight">\(Ma=0.75\)</span>, and <span class="math notranslate nohighlight">\(\alpha = 4^\circ\)</span>, respectively. The pressure coefficient is defined as:</p>
<div class="math notranslate nohighlight">
\[
  c_p = \frac{p}{0.5\rho_\infty U_\infty},
\]</div>
<p>where <span class="math notranslate nohighlight">\(p\)</span> is the total pressure, <span class="math notranslate nohighlight">\(U_\infty\)</span> is the free-stream speed and <span class="math notranslate nohighlight">\(\rho_\infty\)</span> is the free-stream density. The dominant frequency associated with the shock buffet is <span class="math notranslate nohighlight">\(f\approx 38Hz\)</span>.</p>
<p>To execute this exercise, create an empty script or Jupyter notebook in the <em>exercise</em> folder.</p>
<section id="principal-component-analysis">
<h2>Principal component analysis<a class="headerlink" href="#principal-component-analysis" title="Permalink to this headline">#</a></h2>
<section id="loading-and-masking-the-dataset">
<h3>Loading and masking the dataset<a class="headerlink" href="#loading-and-masking-the-dataset" title="Permalink to this headline">#</a></h3>
<p>The simulation was conducted using the OpenFOAM solver <em>rhoCentralFoam</em>. The <a class="reference external" href="https://www.openfoam.com/documentation/guides/latest/doc/guide-fos-field-pressure.html">pressure</a> function object combined with <a class="reference external" href="https://www.openfoam.com/documentation/guides/latest/doc/guide-fos-sampling-surfaces.html">surface sampling</a> was used to compute and write the pressure coefficient. Such data are typically written to the directory <em>postProcessing/surfaces/time/field.csv</em>. If you download the latest lecture dataset, you find the <em>surfaces</em> folder under <em>datasets/naca0012_buffet/surfaces/</em>. To access the data, we use the flowTorch <a class="reference external" href="https://flowmodelingcontrol.github.io/flowtorch-docs/1.0/flowtorch.data.html#module-flowtorch.data.csv_dataloader">CSVDataloader</a>. More specifically, we create a loader object using the <code class="docutils literal notranslate"><span class="pre">CSVDataloader.from_foam_surface()</span></code> class method, which indicates the dataloader how the data are organized:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flowtorch.data</span> <span class="kn">import</span> <span class="n">CSVDataloader</span>

<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;../datasets/naca0012_buffet/surface/&quot;</span>
<span class="n">loader</span> <span class="o">=</span> <span class="n">CSVDataloader</span><span class="o">.</span><span class="n">from_foam_surface</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;total(p)_coeff_airfoil.raw&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The loader provides access to several attributes of the dataset:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">loader.vertices</span></code> returns the x/y/z coordinates of the sample points located on the surface</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loader.write_times</span></code> returns a list of available snapshot times formatted as strings, e.g., “0.01”</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">loader.load_snapshot(field,</span> <span class="pre">time)</span></code> loads a <em>field</em> at the specified <em>time</em>; the <em>time</em> must be given as string</p></li>
</ul>
<p>As a first step, load the vertices, normalize them with the chord length <span class="math notranslate nohighlight">\(c=0.60105m\)</span>, and visualize the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> components (first and second colum of <em>loader.vertices</em>) as scatter plot.</p>
<p>The dataset contains both lower and upper surface (pressure and suction side), but we will analyze only the upper side. Therefore, we create a boolean mask to distinguish between points on the lower and upper surface. flowTorch provides <a class="reference external" href="https://flowmodelingcontrol.github.io/flowtorch-docs/1.0/flowtorch.data.html#module-flowtorch.data.selection_tools">selection tools</a> to create such masks. Use the <em>mask_box()</em> function to select only points on the upper surface. Hint: the airfoil is symmetric with respect to the plane <span class="math notranslate nohighlight">\((x, y=0, z)\)</span>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>from flowtorch.data import mask_box
mask = mask_box(normalized_vertices, lower=[?, ?, -1.0], upper=[?, ?, 1.0])
</pre></div>
</div>
<p>To apply the mask to a tensor, we can use the <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.masked_select.html">masked_select()</a> function. For example, the commands</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">masked_select</span><span class="p">(</span><span class="n">normalized_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">mask</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">masked_select</span><span class="p">(</span><span class="n">normalized_vertices</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
<p>could be used to sub-select the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(z\)</span> component of points on the upper surface. The number of selected points is equal to the sum over all elements in <em>mask</em>, e.g., <code class="docutils literal notranslate"><span class="pre">n_points</span> <span class="pre">=</span> <span class="pre">mask.sum().item()</span></code>.</p>
<p>Next, we analyze the available write times and select a window for the PCA analysis. To do so,</p>
<ul class="simple">
<li><p>print the first and the last write time; the elements of <code class="docutils literal notranslate"><span class="pre">loader.write_times</span></code> are sorted</p></li>
<li><p>compute the time step between the first two snapshots by converting the strings into floats</p></li>
<li><p>create a new list of string-encoded times selecting only the elements of <code class="docutils literal notranslate"><span class="pre">loader.write_times</span></code> with <span class="math notranslate nohighlight">\(0.0326s \le t \le 0.1015s\)</span></p></li>
</ul>
<p>Based on the number of selected points and snapshots, we can now allocate an empty data matrix, in which individual snapshots will be organized as column vectors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>data_matrix = pt.zeros((?, ?))
</pre></div>
</div>
<p>To fill up the data matrix, execute the following steps:</p>
<ul class="simple">
<li><p>loop over the selected times</p></li>
<li><p>load the snapshot at time <em>t</em> using loader.load_snapshot(“f”, t)</p></li>
<li><p>apply the mask to the snapshot</p></li>
<li><p>save the selected data as the corresponding column of the data matrix</p></li>
</ul>
<p>After the data matrix is complete, compute the temporal mean and variance of each point in the data matrix and plot both fields using <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.tricontourf.html">tricontourf</a>. The function call might look similar to the following line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">data_matrix</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>Finally, subtract the mean from each column. Hint: use the <em>dim</em> keyword of the <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.mean.html">mean()</a> function and <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.unsqueeze.html">unsqueeze()</a> the result to convert the row into a column vector, which can be more easily subtracted from each column of the data matrix.</p>
</section>
<section id="computing-the-singular-value-decomposition">
<h3>Computing the singular value decomposition<a class="headerlink" href="#computing-the-singular-value-decomposition" title="Permalink to this headline">#</a></h3>
<p>We compute the PCA be means of a singular value decomposition (SVD) of the mean-subtracted data matrix. The <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.linalg.svd.html?highlight=svd#torch.linalg.svd">svd()</a> function returns three tensors, namely the left singular vectors, the singular values, and the right singular vectors (in that order).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">U</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">VH</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">data_matrix</span><span class="p">,</span> <span class="n">full_matrices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># the right singular vectors are usually returned transposed</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">VH</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<p>The singular values tell us about the importance of each mode. The elements of <em>s</em> are already organized in descending order. Create the following two plots to visualize the importance of the first 50 modes:</p>
<ul class="simple">
<li><p>a <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.bar.html">bar</a> plot of the singular values</p></li>
<li><p>a bar plot of the normalized singular values, i.e., <code class="docutils literal notranslate"><span class="pre">s_rel</span> <span class="pre">=</span> <span class="pre">[si/s.sum().item()</span> <span class="pre">for</span> <span class="pre">si</span> <span class="pre">in</span> <span class="pre">s]</span></code></p></li>
</ul>
</section>
<section id="visualizing-modes-and-mode-coefficients">
<h3>Visualizing modes and mode coefficients<a class="headerlink" href="#visualizing-modes-and-mode-coefficients" title="Permalink to this headline">#</a></h3>
<p>The column vectors of <em>U</em> correspond to the co-called principal components or proper orthogonal modes. Visualize the first five modes (the first five columns of <em>U</em>) as you visualized mean and variance in the first sub-task. What can you say about the first mode?</p>
<p>Convert the selected snapshot times into floating point values and plot the first five columns of <em>V</em> over time. To identify the frequency associated with each mode, use the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.welch.html">welch</a> function as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">welch</span>

<span class="c1"># times is a list containing the selected write times as floats</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">power</span> <span class="o">=</span> <span class="n">welch</span><span class="p">(</span><span class="n">V</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">,</span> <span class="n">nfft</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;mode </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum amplitude at f=</span><span class="si">{</span><span class="n">f</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">power</span><span class="p">)]</span><span class="si">:</span><span class="s2">2.4f</span><span class="si">}</span><span class="s2">Hz&quot;</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$f$ in $Hz$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;PSD&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Which mode is most representative of the shock buffet?</p>
</section>
</section>
<section id="dynamic-mode-decomposition">
<h2>Dynamic mode decomposition<a class="headerlink" href="#dynamic-mode-decomposition" title="Permalink to this headline">#</a></h2>
<p>In the second part of this exercise, we use the same surface pressure data as before but apply dynamic mode decomposition (DMD) to obtain spatial modes that have only a single frequency associated with them. To get started, assemble the data matrix as in the first part of the exercise but do not extract the temporal mean from the snapshots.</p>
<section id="dmd-implementation">
<h3>DMD implementation<a class="headerlink" href="#dmd-implementation" title="Permalink to this headline">#</a></h3>
<p>Computing the DMD essentially consists of four steps:</p>
<ol class="simple">
<li><p>compute the SVD of the data matrix omitting the last snapshot: <span class="math notranslate nohighlight">\( \mathbf{X} = \mathbf{U\Sigma V}^H \)</span></p></li>
<li><p>compute the reduced linear operator <span class="math notranslate nohighlight">\(\tilde{\mathbf{A}} = \mathbf{U}^H\mathbf{X}^\prime\mathbf{V\Sigma}^{-1}\)</span></p></li>
<li><p>compute the eigen decomposition of the reduced linear operator: <span class="math notranslate nohighlight">\(\tilde{\mathbf{A}} = \mathbf{W\Lambda W}^{-1}\)</span></p></li>
<li><p>reconstruct the eigenvectors (modes) of the full linear operator: <span class="math notranslate nohighlight">\(\mathbf{\Phi} = \mathbf{X}^\prime\mathbf{V\Sigma}^{-1}\mathbf{W}\)</span></p></li>
</ol>
<p>Apply the DMD algorithm to the pressure surface coefficient data matrix. For the implementation of this and the next tasks, the following hints might be helpful:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.linalg.svd.html">torch.linalg.svd</a>; use <code class="docutils literal notranslate"><span class="pre">full_matrices=False</span></code></p></li>
<li><p><a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.linalg.eig.html#torch.linalg.eig">torch.linalg.eig</a></p></li>
<li><p><a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.diag.html">torch.diag</a></p></li>
<li><p>to convert a tensor of floats into a complex tensor, use the <em>type</em> method, e.g., <code class="docutils literal notranslate"><span class="pre">matrix.type(pt.cfloat)</span></code></p></li>
<li><p>to access real and imaginary parts of a complex tensor, use the properties <code class="docutils literal notranslate"><span class="pre">matrix.real</span></code> and <code class="docutils literal notranslate"><span class="pre">matrix.imag</span></code></p></li>
<li><p>compute the complex conjugate transpose of a matrix with the syntax <code class="docutils literal notranslate"><span class="pre">matrix.conj().T</span></code></p></li>
<li><p>compute matrix multiplications using the &#64; operator</p></li>
</ul>
<p>To see if the implementation yields sensibe results, plot the eigenvalues in the complex plane. Most eigenvalues should be located on the unit circle. The following code provides most of the lines to create such a plot.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>fig, ax = plt.subplots(1, 1, figsize=(4, 4))
t = pt.linspace(0, 2 * np.pi, 100)
ax.plot(pt.cos(t), pt.sin(t), ls=&quot;--&quot;, color=&quot;k&quot;, lw=2)
ax.scatter(???, ???, marker=&quot;x&quot;, lw=1, s=20, zorder=7)
ax.set_xlim(-1.3, 1.3)
ax.set_ylim(-1.3, 1.3)
ax.set_xlabel(r&quot;$Re(\lambda)$&quot;)
ax.set_ylabel(r&quot;$Im(\lambda)$&quot;)
plt.show()
</pre></div>
</div>
</section>
<section id="plotting-the-spectrum">
<h3>Plotting the spectrum<a class="headerlink" href="#plotting-the-spectrum" title="Permalink to this headline">#</a></h3>
<p>We can now determine the frequency associated with each mode and assign a mode amplitude/importance. The frequency corresponds to the imaginary part of the eigenvalues <span class="math notranslate nohighlight">\(\omega_i\)</span> of the time-continuous linear operator. The eigenvalues of discrete and continuous operator are connected by the relation <span class="math notranslate nohighlight">\(\omega_i = \mathrm{log}(\lambda_i)/\Delta t\)</span>. Deviding the imaginary part of <span class="math notranslate nohighlight">\(\omega_i\)</span> by <span class="math notranslate nohighlight">\(2\pi\)</span> yields the frequency of the <span class="math notranslate nohighlight">\(i\)</span>th mode in <span class="math notranslate nohighlight">\(Hz\)</span>. Use the initial conditions <span class="math notranslate nohighlight">\( \mathbf{b} = \mathbf{\Phi}^{-1}\mathbf{x}_0 \)</span> as mode amplitudes (ignore the imaginary part).</p>
<p>A common way to visualize a spectrum is a <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.stem.html">stem plot</a>. The eigenvalues come as complex conjugate pairs because our data matrix contains only real values. The following code snippet shows how to plot only the positive frequencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">amplitude</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">omega</span><span class="o">.</span><span class="n">imag</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">freq_i_pos</span> <span class="o">=</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="n">freq_i_pos</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">amplitude</span><span class="p">[</span><span class="n">freq_i_pos</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">basefmt</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$f$ in $Hz$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;amplitude&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>Congratulations! This completes the seventh and eighth exercise session.</strong></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="cylinder_pinn_exercise.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Approximating the flow past a cylinder with limited data</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="cylinder_rom_exercise.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Reduced-order modeling of the flow past a cylinder in flowTorch</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By AndreWeiner, converted by thangckt<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>